# Training Streak — привычки и циклы

## Коротко о функциональности
- Карточка отвечает на вопрос «как часто человек держится расписания».
- Мы умеем распознавать разные форматы: дни подряд, недельные нормы и циклы «работа / отдых».
- Без информации об опыте ничего не показываем: пороги сильно зависят от того, новичок перед нами или профи.

## Как опыт влияет на ожидания

Опыт = стаж в тренажерном зале: `BEGINNER` — до года, `INTERMEDIATE` — 1–3 года, `ADVANCED` — 3–5 лет, `PRO` — 5+ лет. Он не задает “норму тренировок в неделю”. Он лишь определяет, сколько истории мы должны увидеть и насколько уверенными должны быть повторяющиеся циклы.

| Experience | Горизонт для `Pattern` | Минимум циклов `Pattern` | Порог уверенности `Pattern` | Минимум блоков `Rhythm` | Порог уверенности `Rhythm` | Комментарий |
| --- | --- | --- | --- | --- | --- | --- |
| `BEGINNER` | 42 дня | 2 | 0.5 | 2 | 0.45 | Быстро реагируем на изменения, допускаем короткие серии. |
| `INTERMEDIATE` | 56 дней | 3 | 0.55 | 3 | 0.5 | Требуем более устойчивых повторений. |
| `ADVANCED` | 63 дня | 3 | 0.6 | 3 | 0.55 | Ожидаем стабильных циклов, но не завышаем требования. |
| `PRO` | 70 дней | 4 | 0.65 | 4 | 0.6 | Нужен четкий ритм и длинная история, чтобы признать цикл. |

Если пользователь тренируется 10 лет по 3 раза в неделю — так и будет: опыт влияет только на то, насколько уверенно мы должны увидеть повторяемость, а не на само число «3».

## Как считаем недельную норму
1. Берем до восьми последних положительных недель (где было минимум одно занятие).
2. Считаем медиану, моду и среднее по этим неделям.
3. Если у нас хотя бы три недели истории, берем моду (самое повторяющееся значение). Иначе смешиваем медиану и последнюю неделю, чтобы не завышать ожидания.
4. Результат ограничиваем разумным пределом (1–10 тренировок).

Таким образом даже профессионал, который годами тренируется три раза в неделю, увидит норму «3». Новичок, который пока сделал всего две недели по два занятия, получит норму «2», пока не наберется больше истории.

## Как строим карточку (простыми словами)
1. Собираем календарь тренировок: на каждый день считаем, был ли хотя бы один сеанс.
2. Пытаемся угадать тип привычки:
   - **Pattern** — когда есть повторяющийся длинный период: например, 4 дня работы → 3 дня отдыха.
   - **Rhythm** — простой цикл без сложных масок: X дней тренируемся и Y дней отдыхаем.
   - **Weekly** — проверяем, тянутся ли подряд недели с выполненной нормой.
   - **Daily** — сколько дней подряд тренировались без пропусков.
3. Показываем самый «богатый» вариант. Если Pattern и Rhythm не нашли достаточно уверенно, берем Weekly. Если и там пусто, переходим к Daily.
4. Всегда возвращаем: тип, длину серии, текущий прогресс (в процентах), настроение (CrushingIt / OnTrack / Restart) и доверие к данным.

## Что означают поля
- `featured` — главный формат серий. Пример: `Weekly(length=2, targetSessionsPerWeek=4, progressPercent=50, confidence=0.7)`.
- `timeline` — последние периоды того же типа. Для Weekly это 4 недели, для Rhythm — несколько блоков, для Daily — последние 7 дней.
- `totalActiveDays` — количество дней с тренировками в рассматриваемом окне.

## Примеры и подсказки
- **Саша (BEGINNER).** Пока есть только две недели: 2 и 3 тренировки. Норма рассчитывается как «около 2–3», и карточка берет 2, чтобы не пугать. Как только появятся три недели по три тренировки, норма вырастет до 3.
- **Марина (INTERMEDIATE).** Она тренируется 4–5 раз в неделю. Алгоритм замечает повторяемость: 3 дня работы и 1–2 дня отдыха. Порог уверенности 50%, и Марина его проходит, поэтому видит `Rhythm`: «Рабочих дней — 3, дней отдыха — 1, серия — 5».
- **Игорь (ADVANCED).** У него циклами по 9 дней: 5 тренируется, 4 восстанавливается. История за последние 63 дня показывает устойчивый рисунок, и мы включаем `Pattern` с периодом 9, целью 5 тренировок и длиной серии 3 (три полных цикла выполнены подряд).
- **Катя (PRO).** Тренируется уже 10 лет, но по 3 раза в неделю. Норма тоже 3, потому что так говорит фактическая история. Карточка `Weekly` честно показывает прогресс текущей недели и не пытается навязать «6 тренеровок» только из-за высокого опыта.

## Что важно знать продукту
- Хотите подсветить возвращение после перерыва? Принудительно показывайте `Daily` в первые недели, чтобы человек видел, как растет серия из двух-трех дней.
- Нужно подчеркнуть дисциплину продвинутых спортсменов? Ставьте акцент на `Pattern` / `Rhythm` и выводите детали цикла текстом: «Рабочие дни: 4, отдых: 2».
- Если карточка пустая, проверьте поле опыта и наличие хотя бы 2–3 тренировок: без этого нейтральнее ничего не показывать, чем придумывать «серии».*** End Patch
